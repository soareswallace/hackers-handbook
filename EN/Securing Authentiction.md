# Securing Authentication

Implementing a secure authentication is, at most of the times, a trade off between UX and security objetives. However the designer/developer has to have in mind some factors to balance between these two:

- The criticality of security given the functionality that the application offers
- The degree to which users will tolerate and work with different types of
authentication controls
- The cost of supporting a less user-friendly system
- The financial cost of competing alternatives in relation to the revenue likely to be generated by the application or the value of the assets it protects

## Use strong credentials

There are couple of rules that should be required to be in place in every system, such as:

- A minimum required of password's quality. Enforcing a minimum length, mixing lowercases with uppercases, avoid common passwords, preventing easily guessable passwords.
- Every username should be unique
- If your system requires auto-generating either passwords or usernames, make sure there is a minimum level of entropy between them to prevent attackers from guessing.

## Handle Credentials Secretively

- Every password shoud be validate in full and unchanged.
- The applications should actively prevent any type of attacks between login and the actual authentication. Any exception during the process should invalidate the current session.
- All authentication logic should be carefully reviewed in both pseudo and actual code.
- If the application allows impersonation it should be careful handled. By being a critical vulnerabilty if explored it should be very well validated before used.
- Multistage logins should also prevent attackers from interfering with the transitions and relationships between the stages: 
    - All data should be handled on the server-side
    - Every piece of data that has already been sent to the server should not be allowed modifications.
    - Every stage should verify if the previous stages were correctly completed.
    - If a login fails between the stages it should not show or log any data that can review which part of the validation have been invalidated.

## Prevent information leakage

- The various authentications mechanisms used by the application should always protected information from disclosure. Any parameters in every query should always be validated between the users privileges.
- Every unknown or unhandled exceptions should always be treated as generic from a client stand point. This avoids information leakage between exceptions.
- Following the "Don't give attackers information" if the application employs account lockout do not give how many minutes, for how many times or which account have been locked.
- If the application supports self-registration it should:
    - Generate unique and unpredictable usernames for each new user.
    - It can use email adress as username and it should send to the email an unique, unguessable URL to the registered email telling the user to following procedures.
    

## Prevent Brute-Force Attacks

- Implement challenges when important actions are made, such as login, password changes, email changes, password changes.
- Use unpredictable usernames preventing user enumaration.
- Account locking balancing the time for reactivation with actions required. However it should never show which of the accounts are locked. If this was the implementation and an account is locked it should never check the credentials during lock to avoid different response or response times during brute-force attacks.
- Challenges, such as CAPTCHAs, can also help preventing brute-force attacks.

## Prevent Misuse of the Password Change Function

- The function should be accessible only from within an authenticated session.

- As a defense-in-depth measure, the function should be protected from unauthorized access gained via some other security defect in the application — such as a session-hijacking vulnerability, cross-site scripting, or even an unattended terminal. To this end, users should be required to reenter their existing password.

- Users should be notified out-of-band (such as via e-mail) that their pass- word has been changed, but the message should not contain either their old or new credentials.

## Prevent Misuse of the Account Recovery Function

- Features such as password “hints” should never be used, because they mainly help an attacker trawl for accounts that have obvious hints set.

- The best automated solution for enabling users to regain control of accounts is to e-mail the user a unique, time-limited, unguessable, single-use recovery URL. Visiting the URL allows the user to set a new password. After this has been done, a second e-mail should be sent, indicating that a password change was made.

## Log, Monitor, and Notify(!!!!)

- The application should log all authentication-related events, including login, logout, password change, password reset, account suspension, and account recovery.

- Anomalies in authentication events should be processed by the application’s real-time alerting and intrusion prevention functionality.

- Users should be notified out-of-band of any critical or non-critical security events.